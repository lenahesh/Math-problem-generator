<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×”×¨×¤×ª×§×” ××ª××˜×™×ª - ××©×—×§ ×œ×™×œ×“×™×</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;700&family=Varela+Round&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FF6B6B;
            --secondary: #4ECDC4;
            --accent: #FFE66D;
        }
        body {
            font-family: 'Varela Round', 'Assistant', sans-serif;
            background: #87CEEB;
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden;
            position: relative;
        }
        .cloud {
            position: absolute;
            background: white;
            border-radius: 50px;
            opacity: 0.8;
            z-index: -1;
            animation: move linear infinite;
        }
        @keyframes move {
            from { right: -200px; }
            to { right: 100vw; }
        }
        .game-card {
            background: rgba(255, 255, 255, 0.95);
            border: 8px solid var(--secondary);
            border-radius: 3rem;
            box-shadow: 0 20px 0 rgba(0,0,0,0.1);
        }
        .btn-game {
            background: var(--primary);
            color: white;
            border-bottom: 6px solid #d64545;
            transition: all 0.1s;
        }
        .btn-game:active {
            border-bottom-width: 0px;
            transform: translateY(6px);
        }
        .option-card {
            cursor: pointer;
            transition: all 0.2s ease;
            border: 4px solid #eee;
            border-radius: 1.5rem;
        }
        .option-card.active {
            border-color: var(--secondary);
            background-color: #e0fffb;
            transform: scale(1.05);
        }
        input[type="number"] {
            direction: ltr;
            text-align: center;
        }
        .character-bounce {
            animation: bounce 2s infinite ease-in-out;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="cloud w-32 h-12" style="top: 10%; animation-duration: 25s;"></div>
    <div class="cloud w-48 h-16" style="top: 25%; animation-duration: 35s; animation-delay: -5s;"></div>
    <div class="cloud w-40 h-14" style="top: 60%; animation-duration: 30s; animation-delay: -15s;"></div>

    <nav class="max-w-4xl mx-auto mb-6 flex justify-between items-center bg-white/90 p-4 rounded-3xl shadow-lg border-b-4 border-gray-200">
        <div class="flex items-center gap-3">
            <span class="text-4xl character-bounce">ğŸ¦Š</span>
            <h1 class="text-2xl font-bold text-orange-500 text-center">×”×¨×¤×ª×§×” ××ª××˜×™×ª</h1>
        </div>
        <div class="flex gap-3 items-center">
            <button onclick="location.reload()" class="bg-blue-500 text-white px-6 py-2 rounded-full font-bold shadow-md hover:bg-blue-600">×‘×™×ª ğŸ </button>
        </div>
    </nav>

    <main class="max-w-4xl mx-auto relative">
        <div id="setupScreen" class="game-card p-6 md:p-10">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-blue-600 mb-2">××™×–×” ×›×™×£ ×©×‘××ª×!</h2>
                <p class="text-gray-600 text-lg">×‘×•××• × ×‘× ×” ×œ×›× ××ª×’×¨ ××™×•×—×“:</p>
            </div>
            
            <div class="space-y-8">
                <div>
                    <label class="block text-xl font-bold mb-4 text-gray-700">ğŸŒˆ ×‘×—×¨ × ×•×©× ×œ×¡×™×¤×•×¨×™×:</label>
                    <div class="grid grid-cols-3 md:grid-cols-5 gap-3" id="themeContainer"></div>
                </div>

                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <label class="block text-xl font-bold mb-4 text-gray-700">âš¡ ×¨××ª ××•×¨×›×‘×•×ª ×”×‘×¢×™×”:</label>
                        <select id="complexity" class="w-full p-4 rounded-2xl border-4 border-gray-100 focus:border-cyan-400 outline-none text-lg font-bold">
                            <option value="1">×¤×©×•×˜×” (×©×œ×‘ ××—×“)</option>
                            <option value="2">×××ª×’×¨×ª (×©× ×™ ×©×œ×‘×™×)</option>
                            <option value="3">××œ×•×£ (×¨×‘-×©×œ×‘×™×ª)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xl font-bold mb-4 text-gray-700">ğŸ”¢ ×˜×•×•×— ××¡×¤×¨×™×:</label>
                        <select id="range" class="w-full p-4 rounded-2xl border-4 border-gray-100 focus:border-cyan-400 outline-none text-lg font-bold">
                            <option value="20">×¢×“ 20</option>
                            <option value="100">×¢×“ 100</option>
                            <option value="1000">×¢×“ 1,000</option>
                            <option value="10000">×¢×“ 10,000</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-xl font-bold mb-4 text-gray-700">ğŸ§  ××” × ×ª×¨×’×œ ×”×™×•×?</label>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-3" id="subjectContainer"></div>
                </div>

                <button id="startGameBtn" class="w-full py-6 btn-game text-white text-3xl font-bold rounded-3xl shadow-xl mt-4">
                    ×™××œ×œ×”, ×™×•×¦××™× ×œ×“×¨×š! ğŸš€
                </button>
            </div>
        </div>

        <div id="gameScreen" class="game-card p-6 md:p-10 hidden text-center">
            <div class="mb-6 flex justify-between items-center">
                <div class="bg-yellow-100 border-2 border-yellow-400 text-yellow-700 px-6 py-2 rounded-full font-bold text-lg" id="statusLabel">×©××œ×” 1</div>
                <div class="bg-green-100 border-2 border-green-400 text-green-700 px-6 py-2 rounded-full font-bold text-lg" id="scoreLabel">×›×•×›×‘×™×: 0 â­</div>
            </div>

            <div class="relative bg-white border-4 border-dashed border-blue-200 p-8 rounded-3xl mb-8 min-h-[220px] flex items-center justify-center">
                <p id="problemText" class="text-2xl md:text-3xl leading-relaxed text-gray-800 font-bold px-4"></p>
            </div>

            <div class="flex flex-col items-center gap-6">
                <div class="relative w-full max-w-xs">
                    <input type="number" id="userAnswer" placeholder="×¨×©××• ×ª×©×•×‘×”..." class="w-full p-6 text-4xl border-4 border-cyan-200 rounded-3xl focus:border-cyan-500 outline-none shadow-inner">
                </div>
                
                <div class="flex gap-4 w-full max-w-md">
                    <button id="hintBtn" class="flex-1 py-4 bg-orange-400 text-white text-xl font-bold rounded-2xl hover:bg-orange-500 shadow-md">
                        ×¦×¨×™×š ×¨××–? ğŸ’¡
                    </button>
                    <button id="checkAnswerBtn" class="flex-[2] py-4 btn-game text-white text-2xl font-bold rounded-2xl">
                        ×‘×“×•×§ ×ª×©×•×‘×” âœ…
                    </button>
                    <button id="skipBtn" class="flex-1 py-4 bg-slate-500 text-white text-xl font-bold rounded-2xl hover:bg-slate-600 shadow-md flex items-center justify-center gap-2">
                         <span>×“×œ×’</span>
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M13 5l7 7-7 7M5 5l7 7-7 7" />
                         </svg>
                    </button>
                </div>
            </div>
            <div id="hintBox" class="mt-4 p-4 rounded-2xl bg-orange-50 text-orange-800 border-2 border-orange-200 hidden italic text-lg"></div>
            <div id="feedback" class="mt-8 p-4 rounded-2xl text-2xl font-bold hidden transform transition-all"></div>
        </div>
    </main>

    <script>
        const THEMES = [
            { id: 'gaming', name: '×’×™×™××™× ×’', icon: 'ğŸ®' },
            { id: 'soccer', name: '×›×“×•×¨×’×œ', icon: 'âš½' },
            { id: 'animals', name: '×—×™×•×ª', icon: 'ğŸ¦' },
            { id: 'science', name: '××“×¢', icon: 'ğŸ§ª' },
            { id: 'basketball', name: '×›×“×•×¨×¡×œ', icon: 'ğŸ€' },
            { id: 'cars', name: '××›×•× ×™×•×ª', icon: 'ğŸš—' },
            { id: 'cooking', name: '×‘×™×©×•×œ', icon: 'ğŸ§' },
            { id: 'shopping', name: '×§× ×™×•×ª', icon: 'ğŸ›’' },
            { id: 'space', name: '×—×œ×œ', icon: 'ğŸš€' }
        ];

        const SUBJECTS = [
            { id: 'addsub', name: '×—×™×‘×•×¨ ×•×—×™×¡×•×¨' },
            { id: 'muldiv', name: '×›×¤×œ ×•×—×™×œ×•×§' },
            { id: 'mixed', name: '×”×›×œ ××”×›×œ' },
            { id: 'comparison', name: '×”×©×•×•××” ×›×¤×œ×™×ª' }
        ];

        // Characters with gender tracking to ensure grammatical correctness
        const CHARACTERS = [
            { name: "×“× ×™", gender: "m" },
            { name: "× ×•×¢×”", gender: "f" },
            { name: "××™×ª×™", gender: "m" },
            { name: "×××™×”", gender: "f" },
            { name: "×¨×•×Ÿ", gender: "m" },
            { name: "×©×™×¨×”", gender: "f" }
        ];

        let gameState = {
            theme: 'gaming',
            complexity: 1,
            range: 100,
            subject: 'addsub',
            score: 0,
            currentProblem: null,
            questionCount: 1
        };

        const setupScreen = document.getElementById('setupScreen');
        const gameScreen = document.getElementById('gameScreen');
        const themeContainer = document.getElementById('themeContainer');
        const subjectContainer = document.getElementById('subjectContainer');
        const problemText = document.getElementById('problemText');
        const userAnswer = document.getElementById('userAnswer');
        const feedback = document.getElementById('feedback');
        const hintBox = document.getElementById('hintBox');
        const scoreLabel = document.getElementById('scoreLabel');
        const statusLabel = document.getElementById('statusLabel');

        function generateProblem() {
            const r = parseInt(gameState.range);
            const comp = parseInt(gameState.complexity);
            const sub = gameState.subject;
            const rand = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
            
            let q = "", a = 0, h = "";
            const char1 = CHARACTERS[rand(0, CHARACTERS.length-1)];
            const char2 = CHARACTERS.find(c => c.name !== char1.name);
            
            const p1 = char1.name;
            const p2 = char2.name;
            const g1 = char1.gender;
            const g2 = char2.gender;

            const type = (sub === 'mixed') ? (Math.random() > 0.5 ? 'addsub' : 'muldiv') : sub;

            // Strict theme logic to prevent cross-theme bugs
            const themeLogics = {
                'soccer': {
                    'addsub': () => {
                        const n1 = rand(10, r/2), n2 = rand(2, Math.min(n1, 20));
                        const scenes = [
                            () => { q = `×œ×§×‘×•×¦×” ×©×œ ${p1} ×”×™×• ${n1} × ×§×•×“×•×ª. ××—×¨×™ ×”× ×™×¦×—×•×Ÿ ×”× ×§×™×‘×œ×• ×¢×•×“ ${n2} × ×§×•×“×•×ª. ×›××” × ×§×•×“×•×ª ×™×© ×œ×”× ×¢×›×©×™×•?`; a = n1 + n2; },
                            () => { q = `×‘××©×—×§ ×›×“×•×¨×’×œ × ×©××¨×• ${n1} ×“×§×•×ª ×œ×¡×™×•×. ×”×©×•×¤×˜ ×”×•×¡×™×£ ×¢×•×“ ${n2} ×“×§×•×ª. ×›××” ×“×§×•×ª × ×•×ª×¨×• ×‘×¡×š ×”×›×œ?`; a = n1 + n2; },
                            () => { q = `×”×©×•×¢×¨ ${p1} ×¡×¤×’ ${n1} ×©×¢×¨×™×. ×‘×¢×•× ×” ×©×¢×‘×¨×” ×”×•× ×¡×¤×’ ${n2} ×©×¢×¨×™× ×¤×—×•×ª. ×›××” ×©×¢×¨×™× ×¡×¤×’ ×‘×¢×•× ×” ×©×¢×‘×¨×”?`; a = n1 - n2; }
                        ];
                        scenes[rand(0, scenes.length-1)]();
                    },
                    'muldiv': () => {
                        const v1 = rand(2, 6), v2 = rand(3, Math.floor(r/v1));
                        const scenes = [
                            () => { q = `×‘×œ×™×’×” ×©×œ ${p1} ×™×© ${v1} ×§×‘×•×¦×•×ª. ×‘×›×œ ×§×‘×•×¦×” ×™×© ${v2} ×©×—×§× ×™×. ×›××” ×©×—×§× ×™× ×™×© ×‘×œ×™×’×”?`; a = v1 * v2; },
                            () => { q = `${p1} ×”×‘×§×™×¢ ${v1 * v2} ×©×¢×¨×™× ×‘-${v1} ××©×—×§×™×. ×× ×‘×›×œ ××©×—×§ ×”×›××•×ª ×”×™×™×ª×” ×©×•×•×”, ×›××” ×”×‘×§×™×¢ ×‘×›×œ ×¤×¢×?`; a = v2; }
                        ];
                        scenes[rand(0, scenes.length-1)]();
                    },
                    'comparison': () => {
                        const f = rand(2, 5), b = rand(2, Math.floor(r/f));
                        if (Math.random() > 0.5) {
                            q = `${p1} ×”×‘×§×™×¢ ${b} ×©×¢×¨×™×. ${p2} ×”×‘×§×™×¢ ×¤×™ ${f} ×™×•×ª×¨. ×›××” ×©×¢×¨×™× ×”×‘×§×™×¢ ${p2}?`; a = b * f;
                        } else {
                            q = `${p1} ×”×‘×§×™×¢ ${b * f} ×©×¢×¨×™×. ×–×” ×¤×™ ${f} ×™×•×ª×¨ ×××” ×©${p2} ×”×‘×§×™×¢${g2==='f'?'×”':''}. ×›××” ×”×‘×§×™×¢${g2==='f'?'×”':''} ${p2}?`; a = b;
                        }
                    }
                },
                'science': {
                    'addsub': () => {
                        const n1 = rand(20, r-20), n2 = rand(5, 15);
                        const scenes = [
                            () => { q = `×‘××¢×‘×“×” ×©×œ ${p1} ×”×™×• ${n1} ××‘×—× ×•×ª. ×”× ×§×™×‘×œ×• ××©×œ×•×— ×©×œ ×¢×•×“ ${n2} ××‘×—× ×•×ª ×—×“×©×•×ª. ×›××” ××‘×—× ×•×ª ×™×© ×œ×”×?`; a = n1 + n2; },
                            () => { q = `×‘× ×™×¡×•×™ ×›×™××™, ×”×˜××¤×¨×˜×•×¨×” ×”×™×™×ª×” ${n1} ××¢×œ×•×ª. ×”×™× ×™×¨×“×” ×‘-${n2} ××¢×œ×•×ª. ××” ×”×˜××¤×¨×˜×•×¨×” ×¢×›×©×™×•?`; a = n1 - n2; }
                        ];
                        scenes[rand(0, scenes.length-1)]();
                    },
                    'muldiv': () => {
                        const v1 = rand(2, 5), v2 = rand(4, Math.floor(r/v1));
                        const scenes = [
                            () => { q = `${p1} ×—×•×§×¨${g1==='f'?'×ª':''} ×—×™×™×“×§×™×. ×‘-${v1} ×¦×œ×•×—×™×•×ª ×™×© ${v2} ×—×™×™×“×§×™× ×‘×›×œ ××—×ª. ×›××” ×—×™×™×“×§×™× ×™×© ×‘×¡×š ×”×›×œ?`; a = v1 * v2; },
                            () => { q = `×‘××™×§×¨×•×¡×§×•×¤ ×©×œ ${p1} ×™×© ${v1 * v2} ×ª××™×. ×”× ××¡×•×“×¨×™× ×‘-${v1} ×©×•×¨×•×ª ×©×•×•×ª. ×›××” ×ª××™× ×™×© ×‘×›×œ ×©×•×¨×”?`; a = v2; }
                        ];
                        scenes[rand(0, scenes.length-1)]();
                    },
                    'comparison': () => {
                        const f = rand(2, 5), b = rand(2, Math.floor(r/f));
                        if (Math.random() > 0.5) {
                            q = `×‘× ×™×¡×•×™ ×©×œ ${p1} ×”×™×• ${b} ×›×•×›×‘×™×. ×‘×˜×œ×¡×§×•×¤ ×©×œ ${p2} ×¨××• ×¤×™ ${f} ×™×•×ª×¨. ×›××” ×›×•×›×‘×™× ×¨××” ${p2}?`; a = b * f;
                        } else {
                            q = `×”×—×œ×œ×™×ª ×©×œ ${p1} ×˜×¡×” ${b * f} ×§×™×œ×•××˜×¨×™×. ×–×” ×¤×™ ${f} ×™×•×ª×¨ ××”××¨×—×§ ×©${p2} ×˜×¡${g2==='f'?'×”':''}. ×›××” ×§×™×œ×•××˜×¨×™× ×˜×¡${g2==='f'?'×”':''} ${p2}?`; a = b;
                        }
                    }
                },
                'gaming': {
                    'addsub': () => {
                        const hp = rand(50, r-20), change = rand(10, 30);
                        if (Math.random() > 0.5) {
                            q = `×œ×“××•×ª ×©×œ ${p1} ×”×™×• ${hp} × ×§×•×“×•×ª ×—×™×™×. ×”×™× ××¦××” ×œ×‘ ×©×”×•×¡×™×£ ×œ×” ${change} × ×§×•×“×•×ª. ×›××” ×™×© ×œ×” ×¢×›×©×™×•?`; a = hp + change;
                        } else {
                            q = `×œ×“××•×ª ×©×œ ${p1} ×”×™×• ${hp} × ×§×•×“×•×ª ×—×™×™×. ×”×™× ××™×‘×“×” ${change} × ×§×•×“×•×ª ×‘×§×¨×‘. ×›××” × ×©××¨×• ×œ×”?`; a = hp - change;
                        }
                    },
                    'muldiv': () => {
                        const groups = rand(2, 5), items = rand(5, Math.floor(r/groups));
                        if (Math.random() > 0.5) {
                            q = `${p1} ×¢×‘×¨${g1==='f'?'×”':''} ${groups} ×©×œ×‘×™×. ×‘×›×œ ×©×œ×‘ ×”×•× ×§×™×‘×œ${g1==='f'?'×”':''} ${items} ×™×”×œ×•××™×. ×›××” ×™×”×œ×•××™× ×™×© ×œ×• ×‘×¡×š ×”×›×œ?`; a = groups * items;
                        } else {
                            q = `${p1} ××¦×${g1==='f'?'×”':''} ${groups * items} ××˜×‘×¢×•×ª ×•×—×™×œ×§${g1==='f'?'×”':''} ××•×ª× ×œ-${groups} ×ª×™×‘×•×ª. ×›××” ××˜×‘×¢×•×ª ×‘×›×œ ×ª×™×‘×”?`; a = items;
                        }
                    },
                    'comparison': () => {
                        const f = rand(2, 5), b = rand(5, Math.floor(r/f));
                        if (Math.random() > 0.5) {
                            q = `${p1} ×¦×‘×¨${g1==='f'?'×”':''} ${b} × ×§×•×“×•×ª. ×œ${p2} ×™×© ×¤×™ ${f} ×™×•×ª×¨ × ×§×•×“×•×ª. ×›××” × ×§×•×“×•×ª ×™×© ×œ${p2}?`; a = b * f;
                        } else {
                            q = `×”×“×¨×§×•×Ÿ ×©×œ ${p1} ×—×–×§ ×¤×™ ${f} ××”×“×¨×§×•×Ÿ ×©×œ ${p2}. ×× ×œ×“×¨×§×•×Ÿ ×©×œ ${p1} ×™×© ${b * f} ×›×•×—, ×›××” ×›×•×— ×™×© ×œ×“×¨×§×•×Ÿ ×©×œ ${p2}?`; a = b;
                        }
                    }
                },
                'cooking': {
                    'addsub': () => {
                        const n1 = rand(20, r-20), n2 = rand(5, 15);
                        if (Math.random() > 0.5) {
                            q = `${p1} ×©×${g1==='f'?'×”':''} ${n1} ×’×¨× ×¡×•×›×¨ ×•×¢×•×“ ${n2} ×’×¨× ×§××—. ××” ×”××©×§×œ ×”×›×•×œ×œ ×©×œ ×”×—×•××¨×™×?`; a = n1 + n2;
                        } else {
                            q = `×”×™×• ${n1} ×¢×•×’×™×•×ª ×‘××˜×‘×—. ${p2} ××›×œ${g2==='f'?'×”':''} ${n2} ××”×Ÿ. ×›××” ×¢×•×’×™×•×ª × ×©××¨×•?`; a = n1 - n2;
                        }
                    },
                    'muldiv': () => {
                        const v1 = rand(3, 8), v2 = rand(2, Math.floor(r/v1));
                        if (Math.random() > 0.5) {
                            q = `${p1} ××›×™×Ÿ${g1==='f'?'×”':''} ${v1} ×ª×‘× ×™×•×ª. ×‘×›×œ ×ª×‘× ×™×ª ×™×© ${v2} ×¢×•×’×•×ª. ×›××” ×¢×•×’×•×ª ×™×© ×‘×¡×š ×”×›×œ?`; a = v1 * v2;
                        } else {
                            q = `${p1} ×—×ª×š${g1==='f'?'×”':''} ×¤×™×¦×” ×œ-${v1 * v2} ××©×•×œ×©×™× ×•×—×™×œ×§${g1==='f'?'×”':''} ××•×ª× ×œ-${v1} ×™×œ×“×™×. ×›××” ×§×™×‘×œ ×›×œ ×™×œ×“?`; a = v2;
                        }
                    },
                    'comparison': () => {
                        const f = rand(2, 4), b = rand(5, Math.floor(r/f));
                        if (Math.random() > 0.5) {
                            q = `${p1} ×”×›×™×Ÿ${g1==='f'?'×”':''} ${b} ×¡×•×¤×’× ×™×•×ª. ${p2} ×”×›×™×Ÿ${g2==='f'?'×”':''} ×¤×™ ${f} ×™×•×ª×¨. ×›××” ×”×›×™×Ÿ${g2==='f'?'×”':''} ${p2}?`; a = b * f;
                        } else {
                            q = `${p1} ×§×˜×£${g1==='f'?'×”':''} ${b * f} ×ª×¤×•×—×™×. ×–×” ×¤×™ ${f} ×™×•×ª×¨ ×××” ×©${p2} ×§×˜×£${g2==='f'?'×”':''}. ×›××” ×§×˜×£${g2==='f'?'×”':''} ${p2}?`; a = b;
                        }
                    }
                }
            };

            // Generic fallback if theme doesn't match above
            const useTheme = themeLogics[gameState.theme] || themeLogics['gaming'];
            const solve = useTheme[type] || useTheme['addsub'];
            solve();

            // Complexity additions (Multi-step)
            if (comp >= 2 && type !== 'comparison') {
                const step2 = rand(2, 20);
                if (Math.random() > 0.5) {
                    q += ` ×œ××—×¨ ××›×Ÿ ×”×’×™×¢ ×¢×•×“ ××™×©×”×• ×•×”×•×¡×™×£ ${step2}. ××” ×”×ª×•×¦××” ×”×¡×•×¤×™×ª?`;
                    a += step2;
                } else {
                    q += ` ×•××– ×”×•×¨×™×“×• ××”×ª×•×¦××” ${step2}. ××” ×”×ª×•×¦××” ×¢×›×©×™×•?`;
                    a -= step2;
                }
            }

            return { q, a, h: "×§×¨××• ××ª ×”×¡×™×¤×•×¨ ×©×œ×‘ ××—×¨×™ ×©×œ×‘ ×•×‘×¦×¢×• ××ª ×”×—×™×©×•×‘." };
        }

        function initUI() {
            themeContainer.innerHTML = '';
            THEMES.forEach(t => {
                const div = document.createElement('div');
                div.className = `option-card p-4 bg-white flex flex-col items-center gap-1 ${gameState.theme === t.id ? 'active' : ''}`;
                div.innerHTML = `<span class="text-3xl">${t.icon}</span><span class="text-sm font-bold">${t.name}</span>`;
                div.onclick = () => {
                    document.querySelectorAll('#themeContainer .option-card').forEach(el => el.classList.remove('active'));
                    div.classList.add('active');
                    gameState.theme = t.id;
                };
                themeContainer.appendChild(div);
            });

            subjectContainer.innerHTML = '';
            SUBJECTS.forEach(s => {
                const div = document.createElement('div');
                div.className = `option-card p-3 bg-white text-center font-bold ${gameState.subject === s.id ? 'active' : ''}`;
                div.innerText = s.name;
                div.onclick = () => {
                    document.querySelectorAll('#subjectContainer .option-card').forEach(el => el.classList.remove('active'));
                    div.classList.add('active');
                    gameState.subject = s.id;
                };
                subjectContainer.appendChild(div);
            });
        }

        document.getElementById('startGameBtn').onclick = () => {
            gameState.complexity = parseInt(document.getElementById('complexity').value);
            gameState.range = parseInt(document.getElementById('range').value);
            gameState.score = 0;
            gameState.questionCount = 1;
            setupScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            nextQuestion();
        };

        function nextQuestion() {
            gameState.currentProblem = generateProblem();
            problemText.innerText = gameState.currentProblem.q;
            userAnswer.value = '';
            feedback.classList.add('hidden');
            hintBox.classList.add('hidden');
            statusLabel.innerText = `×©××œ×” ${gameState.questionCount}`;
            scoreLabel.innerText = `×›×•×›×‘×™×: ${gameState.score} â­`;
            userAnswer.focus();
        }

        document.getElementById('hintBtn').onclick = () => {
            hintBox.innerText = gameState.currentProblem.h;
            hintBox.classList.remove('hidden');
        };

        document.getElementById('skipBtn').onclick = () => {
            gameState.questionCount++;
            nextQuestion();
        };

        document.getElementById('checkAnswerBtn').onclick = checkAnswer;
        userAnswer.onkeydown = (e) => { if(e.key === 'Enter') checkAnswer(); };

        function checkAnswer() {
            const val = parseInt(userAnswer.value);
            if (isNaN(val)) return;
            feedback.classList.remove('hidden');
            if (val === gameState.currentProblem.a) {
                gameState.score += 10;
                gameState.questionCount++;
                feedback.innerHTML = "×›×œ ×”×›×‘×•×“! ×¤×ª×¨×ª× × ×›×•×Ÿ! ğŸŒŸğŸ†";
                feedback.className = "mt-8 p-4 rounded-2xl text-2xl font-bold bg-green-100 text-green-700 animate-bounce";
                setTimeout(nextQuestion, 2000);
            } else {
                feedback.innerHTML = "×œ× ×‘×“×™×•×§... × ×¡×• ×©×•×‘! ğŸ’ª";
                feedback.className = "mt-8 p-4 rounded-2xl text-2xl font-bold bg-red-100 text-red-600";
            }
        }
        initUI();
    </script>
</body>
</html>